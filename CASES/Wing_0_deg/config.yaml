# FILE: CASES/Wing_5_deg/config.yaml
# ==============================================================================
# LBM SOLVER CONFIGURATION (D3Q27 WMLES - High Re Production Mode)
# ==============================================================================
# This file controls the physics, numerics, and geometry for the Lattice Boltzmann 
# simulation. It uses the D3Q27 velocity set with a WALE turbulence model and 
# Wall-Modeled Large Eddy Simulation (WMLES) capability.
#
# MASTER CONTROL
# ==============================================================================

# ##############################################################################
#                 BASIC PARAMETERS
# ##############################################################################

basic:
  # --------------------------------------------------------------------------
  # INPUT GEOMETRY
  # --------------------------------------------------------------------------
  # The STL file defining the obstacle. 
  # IMPORTANT: The code looks for this file INSIDE your active case folder.
  stl_file: "model.stl"

  # Scale factor applied to the STL geometry vertices.
  stl_scale: 1.

  # [deg] Model rotation around Y axis (angle of attack).
  # Rotation is applied to the STL mesh before domain generation.
  alpha: 0.0

  # [deg] Model rotation around Z axis (sideslip angle).
  # Applied after alpha rotation. Ignored when symmetric_analysis=true.
  beta: 0.0

  # [m] Max allowed triangle edge length. 0 = no subdivision.
  minimum_facet_size: 0.0

  # --------------------------------------------------------------------------
  # MESH RESOLUTION
  # --------------------------------------------------------------------------
  # Determines the density of the grid.
  # "N" cells spanning the reference length.
  surface_resolution: 150
  
  # Number of grid refinement levels (Multi-grid).
  num_levels: 5
  
  # --------------------------------------------------------------------------
  # REFERENCE VALUES (Required for Aerodynamic Coefficients)
  # --------------------------------------------------------------------------
  reference_area_of_full_model: 135.3
  
  # Mean Aerodynamic Chord (MAC) or characteristic length.
  reference_chord: 5.34
  
  # The length used to calculate the Reynolds number.
  reference_length_for_meshing: 14
  
  # Options: "x", "y", "z". Usually "x" for flow aligned with X-axis.
  reference_dimension: "x"
  
  # --------------------------------------------------------------------------
  # PHYSICS
  # --------------------------------------------------------------------------
  fluid:
    # Air density at sea level (or your specific fluid). [kg/m³]
    density: 1.225
    
    # Kinematic Viscosity (nu = mu / rho). [m²/s]
    kinematic_viscosity: 1.5e-5
  
  flow:
    # Free-stream inlet velocity in physical units [m/s].
    velocity: 130.0

  simulation:
    # Total number of time steps to run.
    steps: 12000
    
    # Number of steps to ramp up the velocity from 0 to 'velocity'.
    ramp_steps: 2000
    
    # How often to write full 3D VTK output files.
    output_freq: 2000
    
    # Name of the folder where results will be saved.
    output_dir: "RESULTS"

    # --------------------------------------------------------------------------
    # OUTPUT CONTROL
    # --------------------------------------------------------------------------
    output_fields:
      density: true          # Important for compressible flows
      velocity: true
      velocity_magnitude: true
      vorticity: false
      obstacle: true
      level: true
      bouzidi: false

# ##############################################################################
#                 ADVANCED PARAMETERS
# ##############################################################################

advanced:
  # --------------------------------------------------------------------------
  # LBM NUMERICS
  # --------------------------------------------------------------------------
  numerics:
    u_lattice: 0.15            # Ma_lattice ≈ 0.26 for compressible correction
    collision_operator: "cumulant"
    c_wale: 0.50
    tau_min: 0.501
    tau_safety_factor: 1.0
    inlet_turbulence_intensity: 0.0
    nu_sgs_background: 0.0
    sponge_blend_distributions: false

    # Ma_physical ≈ 0.38 — mild compressibility, correction recommended
    compressibility_correction: true

    cumulant:
      omega_bulk: 1.0
      omega_3: 1.0
      omega_4: 1.0
      adaptive_omega_4: true
      lambda_param: 0.1667
      limiter: "positivity"
  
  # --------------------------------------------------------------------------
  # HIGH REYNOLDS NUMBER OPTIONS
  # --------------------------------------------------------------------------
  high_re:
    auto_levels: false
    max_levels: 12
    min_coarse_blocks: 4
    
    # WALL MODEL (Equilibrium Stress Model)
    wall_model:
      enabled: true               # true = Activate Wall Model.
      type: "equilibrium"         # Currently supports "equilibrium" (Spalding/Log-law).
      y_plus_target: 100.0        # Target y+ for the first cell center (approximate).
      
    # Adaptive Mesh Refinement (AMR) - Placeholder for future use.
    adaptive_refinement:
      enabled: false
      criterion: "vorticity"
      threshold: 0.1
  
  # --------------------------------------------------------------------------
  # DOMAIN SIZING
  # --------------------------------------------------------------------------
  domain:
    upstream: 0.75        # Space in front of the object.
    downstream: 1.5       # Space behind the object (wake region).
    lateral: 0.75         # Space to the sides.
    height: 0.75          # Space above/below.
    
    # Thickness of the viscosity sponge layer at boundaries.
    sponge_thickness: 0.10
  
  # --------------------------------------------------------------------------
  # MESH REFINEMENT
  # --------------------------------------------------------------------------
  refinement:
    block_size: 8
    margin: 2
    strategy: "geometry_first"
    
    # If true, assumes symmetry plane at Y=0.
    symmetric_analysis: true
    
    # Wake refinement zone (Box behind the object).
    wake_enabled: false
    wake_length: 0.25
    wake_width_factor: 0.1
    wake_height_factor: 0.1
  
  # --------------------------------------------------------------------------
  # BOUNDARY CONDITIONS
  # --------------------------------------------------------------------------
  boundary:
    method: "bouzidi"
    bouzidi_levels: 1
    use_float16_qmap: true
    q_min_threshold: 0.001
  
  # --------------------------------------------------------------------------
  # FORCE/MOMENT COMPUTATION
  # --------------------------------------------------------------------------
  forces:
    enabled: true                  # Calculate Lift/Drag/Moment?
    output_freq: 0                 # 0 = Matches diagnostics frequency.
    moment_center: [0.25, 0.0, 0.0]
    net_force_export: true         # Export two-sided net force per triangle (CSV + VTK)
  
  # --------------------------------------------------------------------------
  # DIAGNOSTICS
  # --------------------------------------------------------------------------
  diagnostics:
    freq: 100
    stability_check: true
    print_tau_warning: true
  
  # --------------------------------------------------------------------------
  # GPU OPTIMIZATION
  # --------------------------------------------------------------------------
  thermal:
    prandtl: 0.71
    t_inlet: 1.0
    t_wall: 1.0
    t_initial: 1.0
    wall_bc: "adiabatic"

  gpu:
    async_depth: 8
    use_streams: true
    prefetch_neighbors: true